const _0x111316=_0x3092;(function(_0x158075,_0x910655){const _0x4c11b7=_0x3092,_0x10bc2b=_0x158075();while(!![]){try{const _0x1526fc=-parseInt(_0x4c11b7(0x185))/0x1+-parseInt(_0x4c11b7(0x163))/0x2+-parseInt(_0x4c11b7(0x168))/0x3+-parseInt(_0x4c11b7(0x19f))/0x4+-parseInt(_0x4c11b7(0x171))/0x5+-parseInt(_0x4c11b7(0x16b))/0x6*(-parseInt(_0x4c11b7(0x15f))/0x7)+parseInt(_0x4c11b7(0x157))/0x8;if(_0x1526fc===_0x910655)break;else _0x10bc2b['push'](_0x10bc2b['shift']());}catch(_0xa3bac5){_0x10bc2b['push'](_0x10bc2b['shift']());}}}(_0x4c4a,0xe1db8));import _0x3ed2c5 from'fs';import _0x6ff2d6 from'path';import _0x2c85b0 from'node-fetch';import{createCanvas,loadImage}from'canvas';function _0x4c4a(){const _0x411c69=['isFinite','single_select','json','harga','‚ùå\x20Batalkan\x20Transaksi','qr_string','pending','footer','toLowerCase','min','product','Gunakan:\x20cancel\x20<transactionId>','HTTP\x20','üõí\x20Keranjang\x20kosong.','toLocaleString','push','üßæ\x20*CHECKOUT\x20PESANAN*\x0a\x0a','\x20=\x20','reply','trx_menu','image/png','https://cashify.my.id/api/generate','cancel','minFee','status\x20','4949104AZtaLa','qrKey','toISOString','stock','existsSync','/qris','readFileSync','floor','https://larabert-qrgen.hf.space/v1/create-qr-code?','selectedRowId','command','üì¶\x20*STATUS\x20TRANSAKSI*\x0aüÜî\x20ID\x20\x20\x20\x20\x20:\x20','slice','‚ö†Ô∏è\x20*Stok\x20Terbatas*\x0a','canceled_at','logo.png','üîé\x20Cek\x20Status\x20Pesanan','qrisLogo','transactionId','‚úÖ\x20Transaksi\x20berhasil\x20dibatalkan.','üì¶\x20Opsi\x20Transaksi','\x20√ó\x20','tmp','subtotal','chat','sendMessage','‚ùå\x20Gagal\x20membuat\x20QRIS.\x20Silakan\x20coba\x20lagi.','Gunakan:\x20status\x20<transactionId>','\x0aüìä\x20Status\x20:\x20','checkout','Beberapa\x20item\x20melebihi\x20stok\x20dan\x20disesuaikan:\x0a\x0a','.png','length','error','listResponse','database','split','cwd','qris_','cashifyQrisId','tags','help','shift','cashifyLicenseKey','trim','35118144DuJscu','500x500','‚ùå\x20Gagal\x20membatalkan\x20transaksi.','Pilih\x20Aksi','toString','items','map','/cancel-status','85414MmetiQ','findIndex','width','[QRIS\x20ERROR]','1161760vGFiVb','\x0a‚öôÔ∏è\x20Fee\x20Admin\x20\x20\x20:\x20','\x0aüí≥\x20Total\x20Bayar\x20:\x20','sender','status','2649741yQotBO','join','now','354PTKOFD','group','stringify','keranjang','application/json','id-ID','3695045nnXrNO','toBuffer','getContext','‚ùå\x20Nominal\x20pembayaran\x20tidak\x20valid.','singleSelectReply','maxFee','dirname','sendButtonMsg','cancel\x20<trxId>','.json','POST','text','writeFileSync','\x0a\x0aüí∞\x20Total\x20Produk\x20:\x20','\x0a\x0a‚è≥\x20Berlaku\x2015\x20menit\x0aüÜî\x20','\x20sisa\x20','packageCashify','data','toUpperCase','qty','744162VlzNhE'];_0x4c4a=function(){return _0x411c69;};return _0x4c4a();}import{startTransactionPoller}from'../../lib/transaction.js';const STOCK_DIR=_0x6ff2d6[_0x111316(0x169)](process['cwd'](),_0x111316(0x14d),_0x111316(0x1a2)),CART_DIR=_0x6ff2d6[_0x111316(0x169)](process[_0x111316(0x14f)](),_0x111316(0x14d),_0x111316(0x16e)),TX_DIR=_0x6ff2d6['join'](process['cwd'](),_0x111316(0x14d),'transaction'),TMP_DIR=_0x6ff2d6[_0x111316(0x169)](process[_0x111316(0x14f)](),_0x111316(0x140)),API_BASE=_0x111316(0x19b),LICENSE=global[_0x111316(0x155)],QRIS_ID=global[_0x111316(0x151)],LOGO=global[_0x111316(0x13b)]||_0x6ff2d6[_0x111316(0x169)](process[_0x111316(0x14f)](),_0x111316(0x139)),rup=_0x35565a=>'Rp'+Number(_0x35565a||0x0)[_0x111316(0x194)](_0x111316(0x170)),norm=_0x127bef=>String(_0x127bef||'')[_0x111316(0x156)]()['toLowerCase']();function ensureDir(_0x2339b2){try{_0x3ed2c5['mkdirSync'](_0x2339b2,{'recursive':!![]});}catch{}}function readJSON(_0x111256,_0x3ce371){const _0x16b501=_0x111316;if(!_0x3ed2c5[_0x16b501(0x1a3)](_0x111256))return _0x3ce371;try{return JSON['parse'](_0x3ed2c5[_0x16b501(0x1a5)](_0x111256,'utf8'));}catch{return _0x3ce371;}}function writeJSON(_0x3199ce,_0x42b03e){const _0x5a2cdc=_0x111316;ensureDir(_0x6ff2d6[_0x5a2cdc(0x177)](_0x3199ce)),_0x3ed2c5[_0x5a2cdc(0x17d)](_0x3199ce,JSON[_0x5a2cdc(0x16d)](_0x42b03e,null,0x2));}function uuid(){const _0x5e8a4e=_0x111316;return Math['random']()['toString'](0x24)[_0x5e8a4e(0x1ab)](0x2)+Date[_0x5e8a4e(0x16a)]()[_0x5e8a4e(0x15b)](0x24);}const cartFile=_0x8189e=>_0x6ff2d6['join'](CART_DIR,_0x8189e+'.json'),txFile=_0x27a4b=>_0x6ff2d6[_0x111316(0x169)](TX_DIR,_0x27a4b+'.json'),stockFile=_0xd97ef8=>_0x6ff2d6[_0x111316(0x169)](STOCK_DIR,norm(_0xd97ef8)+_0x111316(0x17a)),readCart=_0x2923cb=>readJSON(cartFile(_0x2923cb),{'items':[]}),writeCart=(_0xe6bc98,_0x2f67e3)=>writeJSON(cartFile(_0xe6bc98),_0x2f67e3),readTx=_0x4ebb87=>readJSON(txFile(_0x4ebb87),[]),writeTx=(_0x2270ac,_0xabf177)=>writeJSON(txFile(_0x2270ac),_0xabf177);function readStock(_0x16e758){const _0x446b4b=_0x111316;if(!_0x3ed2c5[_0x446b4b(0x1a3)](stockFile(_0x16e758)))return{'harga':0x0,'items':[]};const _0x145f68=readJSON(stockFile(_0x16e758),{});return{'harga':Number(_0x145f68['harga']||0x0),'items':Array['isArray'](_0x145f68[_0x446b4b(0x15c)])?_0x145f68[_0x446b4b(0x15c)]:[]};}function _0x3092(_0x593d52,_0x25882b){_0x593d52=_0x593d52-0x137;const _0x4c4a6d=_0x4c4a();let _0x309289=_0x4c4a6d[_0x593d52];return _0x309289;}function writeStock(_0x5c7e92,_0x1bb9f4){writeJSON(stockFile(_0x5c7e92),_0x1bb9f4);}async function postJSON(_0xfc5cb7,_0x40e320){const _0x6975b4=_0x111316,_0x3c06c0=await _0x2c85b0(_0xfc5cb7,{'method':_0x6975b4(0x17b),'headers':{'content-type':_0x6975b4(0x16f),'x-license-key':LICENSE},'body':JSON['stringify'](_0x40e320)}),_0x369442=await _0x3c06c0[_0x6975b4(0x188)]()['catch'](()=>({}));if(!_0x3c06c0['ok'])throw new Error(_0x6975b4(0x192)+_0x3c06c0[_0x6975b4(0x167)]);return _0x369442;}async function makeQrisWatermarkFromString(_0x11ad8c){const _0x21a740=_0x111316;ensureDir(TMP_DIR);const _0xd9f45f=_0x21a740(0x1a7)+new URLSearchParams({'size':_0x21a740(0x158),'style':'2','color':'000000','data':_0x11ad8c}),_0x1797ba=await loadImage(_0xd9f45f);let _0x45ed0f=null;try{_0x45ed0f=await loadImage(LOGO);}catch{}const _0x133d44=Math['min'](_0x1797ba[_0x21a740(0x161)],_0x1797ba['height']),_0x1d5f0a=createCanvas(_0x133d44,_0x133d44),_0x5953a3=_0x1d5f0a[_0x21a740(0x173)]('2d');_0x5953a3['drawImage'](_0x1797ba,0x0,0x0,_0x133d44,_0x133d44);if(_0x45ed0f)_0x5953a3['drawImage'](_0x45ed0f,0x0,0x0,_0x133d44,_0x133d44);const _0x36c561=_0x6ff2d6[_0x21a740(0x169)](TMP_DIR,_0x21a740(0x150)+Date[_0x21a740(0x16a)]()+_0x21a740(0x149));return _0x3ed2c5[_0x21a740(0x17d)](_0x36c561,_0x1d5f0a[_0x21a740(0x172)](_0x21a740(0x19a))),_0x36c561;}async function cmdCheckout(_0x38076,_0x4c26f2){const _0x2b68ef=_0x111316,_0x25d254=_0x38076[_0x2b68ef(0x166)][_0x2b68ef(0x14e)]('@')[0x0],_0x3cdd49=readCart(_0x25d254);if(!_0x3cdd49['items'][_0x2b68ef(0x14a)])return _0x38076['reply'](_0x2b68ef(0x193));let _0x43d58f=[],_0x4caa56=0x0,_0x1b124c=[];for(const _0x311d07 of _0x3cdd49[_0x2b68ef(0x15c)]){const _0x5974a1=readStock(_0x311d07['product']),_0x5ed2d7=Math[_0x2b68ef(0x18f)](Number(_0x311d07[_0x2b68ef(0x184)]||0x0),_0x5974a1[_0x2b68ef(0x15c)][_0x2b68ef(0x14a)]);if(_0x5ed2d7>0x0&&_0x5974a1[_0x2b68ef(0x189)]>0x0){const _0x1ca819=_0x5ed2d7*_0x5974a1[_0x2b68ef(0x189)];_0x43d58f[_0x2b68ef(0x195)]({'product':_0x311d07[_0x2b68ef(0x190)],'qty':_0x5ed2d7,'unitPrice':_0x5974a1[_0x2b68ef(0x189)],'subtotal':_0x1ca819}),_0x4caa56+=_0x1ca819;}_0x311d07[_0x2b68ef(0x184)]>_0x5ed2d7&&_0x1b124c[_0x2b68ef(0x195)]({'product':_0x311d07[_0x2b68ef(0x190)],'qty':_0x311d07['qty']-_0x5ed2d7});}_0x1b124c[_0x2b68ef(0x14a)]&&await _0x38076['reply'](_0x2b68ef(0x137)+_0x2b68ef(0x148)+_0x1b124c['map'](_0x56ee41=>'‚Ä¢\x20'+_0x56ee41[_0x2b68ef(0x190)]+_0x2b68ef(0x180)+_0x56ee41[_0x2b68ef(0x184)])['join']('\x0a'));if(!_0x43d58f['length']||_0x4caa56<=0x0)return _0x38076[_0x2b68ef(0x198)]('‚ùå\x20Semua\x20stok\x20kosong.');const _0x2ed527=Number(global[_0x2b68ef(0x19d)]),_0x345626=Number(global[_0x2b68ef(0x176)]),_0x2d445d=Number[_0x2b68ef(0x186)](_0x2ed527)?_0x2ed527:0xa,_0x29f86e=Number[_0x2b68ef(0x186)](_0x345626)?_0x345626:0x32,_0x3d184a=_0x29f86e>=_0x2d445d?Math[_0x2b68ef(0x1a6)](Math['random']()*(_0x29f86e-_0x2d445d+0x1))+_0x2d445d:_0x2d445d,_0x1dfdae=_0x4caa56+_0x3d184a;if(!Number[_0x2b68ef(0x186)](_0x1dfdae)||_0x1dfdae<=0x0)return _0x38076[_0x2b68ef(0x198)](_0x2b68ef(0x174));const _0x4f302b=await postJSON(API_BASE+_0x2b68ef(0x1a4),{'id':QRIS_ID,'amount':_0x1dfdae,'useUniqueCode':!![],'packageIds':[global[_0x2b68ef(0x181)]],'expiredInMinutes':0xf});if(!_0x4f302b?.[_0x2b68ef(0x182)]?.[_0x2b68ef(0x13c)]||!_0x4f302b?.[_0x2b68ef(0x182)]?.[_0x2b68ef(0x18b)])return console[_0x2b68ef(0x14b)](_0x2b68ef(0x162),_0x4f302b),_0x38076['reply'](_0x2b68ef(0x144));const {transactionId:_0x52fcd6,qr_string:_0x51256d}=_0x4f302b[_0x2b68ef(0x182)],_0x57253a=await makeQrisWatermarkFromString(_0x51256d),_0x33bb2b=_0x2b68ef(0x196)+_0x43d58f[_0x2b68ef(0x15d)](_0x2a12bb=>'‚Ä¢\x20'+_0x2a12bb['product']+_0x2b68ef(0x13f)+_0x2a12bb[_0x2b68ef(0x184)]+_0x2b68ef(0x197)+rup(_0x2a12bb[_0x2b68ef(0x141)]))['join']('\x0a')+_0x2b68ef(0x17e)+rup(_0x4caa56)+_0x2b68ef(0x164)+rup(_0x3d184a)+_0x2b68ef(0x165)+rup(_0x1dfdae)+_0x2b68ef(0x17f)+_0x52fcd6,_0x158d37=await _0x4c26f2[_0x2b68ef(0x178)](_0x38076['chat'],{'image':_0x3ed2c5[_0x2b68ef(0x1a5)](_0x57253a),'caption':_0x33bb2b,'footer':global[_0x2b68ef(0x18d)],'buttons':[{'buttonId':_0x2b68ef(0x199),'buttonText':{'displayText':_0x2b68ef(0x13e)},'type':0x2,'nativeFlowInfo':{'name':_0x2b68ef(0x187),'paramsJson':JSON[_0x2b68ef(0x16d)]({'title':'Transaksi','sections':[{'title':_0x2b68ef(0x15a),'rows':[{'title':_0x2b68ef(0x13a),'id':_0x2b68ef(0x19e)+_0x52fcd6},{'title':_0x2b68ef(0x18a),'id':'cancel\x20'+_0x52fcd6}]}]})}}]},{'quoted':_0x38076});writeTx(_0x25d254,[{'id':uuid(),'chat':_0x38076[_0x2b68ef(0x142)],'status':_0x2b68ef(0x18c),'transactionId':_0x52fcd6,'items':_0x43d58f,'fee':_0x3d184a,'totalProduk':_0x4caa56,'totalAmount':_0x1dfdae,'qrPath':_0x57253a,'qrKey':_0x158d37['key'],'newCartItems':_0x1b124c,'created_at':new Date()['toISOString']()}]);}async function cmdStatus(_0x46cc1e,_0xf9fe8){const _0x532eff=_0x111316,_0x149773=(_0xf9fe8||'')[_0x532eff(0x156)]();if(!_0x149773)return _0x46cc1e[_0x532eff(0x198)](_0x532eff(0x145));let _0x14fde7;try{_0x14fde7=await postJSON(API_BASE+'/check-status',{'transactionId':_0x149773});}catch{return _0x46cc1e[_0x532eff(0x198)]('‚ùå\x20Gagal\x20cek\x20status\x20transaksi.');}const _0x513af7=String(_0x14fde7?.[_0x532eff(0x182)]?.[_0x532eff(0x167)]||'')[_0x532eff(0x183)]();return _0x46cc1e[_0x532eff(0x198)](_0x532eff(0x1aa)+_0x149773+_0x532eff(0x146)+_0x513af7+'\x0a\x0a‚ÑπÔ∏è\x20Jika\x20status\x20*PAID*,\x20akun\x20akan\x20dikirim\x20otomatis.');}async function cmdCancel(_0x364623,_0x51c22e){const _0x4eed90=_0x111316,_0x2136ff=_0x364623['sender']['split']('@')[0x0],_0x211e1d=(_0x51c22e||'')[_0x4eed90(0x156)]();if(!_0x211e1d)return _0x364623[_0x4eed90(0x198)](_0x4eed90(0x191));try{await postJSON(API_BASE+_0x4eed90(0x15e),{'transactionId':_0x211e1d});}catch{return _0x364623['reply'](_0x4eed90(0x159));}const _0x5959b6=readTx(_0x2136ff),_0x19c1e9=_0x5959b6[_0x4eed90(0x160)](_0xd5b103=>_0xd5b103['transactionId']===_0x211e1d);if(_0x19c1e9!==-0x1){_0x5959b6[_0x19c1e9][_0x4eed90(0x167)]=_0x4eed90(0x19c),_0x5959b6[_0x19c1e9][_0x4eed90(0x138)]=new Date()[_0x4eed90(0x1a1)]();try{_0x5959b6[_0x19c1e9]['qrKey']&&await fenrys[_0x4eed90(0x143)](_0x5959b6[_0x19c1e9]['qrKey']['remoteJid'],{'delete':_0x5959b6[_0x19c1e9][_0x4eed90(0x1a0)]});}catch{}writeTx(_0x2136ff,_0x5959b6);}return _0x364623['reply'](_0x4eed90(0x13d));}let handler=async(_0x5857a3,{q:_0x4bf009,fenrys:_0x175557})=>{const _0x55f289=_0x111316;startTransactionPoller(_0x175557,0x1388);let _0x31fb1a=_0x5857a3[_0x55f289(0x17c)]||'';if(!_0x31fb1a&&_0x5857a3[_0x55f289(0x14c)]?.[_0x55f289(0x175)]?.[_0x55f289(0x1a8)])_0x31fb1a=_0x5857a3[_0x55f289(0x14c)]['singleSelectReply'][_0x55f289(0x1a8)];const _0x875b4b=_0x31fb1a[_0x55f289(0x156)]()['split'](/\s+/),_0x13b741=(_0x875b4b[_0x55f289(0x154)]()||'')[_0x55f289(0x18e)](),_0x2ec64d=_0x875b4b[_0x55f289(0x169)]('\x20');if(_0x13b741===_0x55f289(0x147))return cmdCheckout(_0x5857a3,_0x175557);if(_0x13b741===_0x55f289(0x167))return cmdStatus(_0x5857a3,_0x2ec64d);if(_0x13b741===_0x55f289(0x19c))return cmdCancel(_0x5857a3,_0x2ec64d);};handler[_0x111316(0x1a9)]=/^(checkout|status|cancel)$/i,handler[_0x111316(0x152)]=['store'],handler[_0x111316(0x153)]=[_0x111316(0x147),'status\x20<trxId>',_0x111316(0x179)],handler[_0x111316(0x16c)]=![];export default handler;